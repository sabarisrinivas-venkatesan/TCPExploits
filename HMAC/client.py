import socket            
import sys
import hashlib
import pickle

def customhash(data,key,source):
    string = data + key + source
    string = hashlib.md5(string.encode())
    for i in range (1,100):
        #print (str(string.hexdigest()),"\n")
        if (i%2 == 0):
            string = hashlib.sha256(str(string.hexdigest()).encode())
        else:
            string = hashlib.sha512(str(string.hexdigest()).encode())

    print ("HMAC Digest is ",str(string.hexdigest()),"\n")
    return (str(string.hexdigest()))




message = sys.argv[1]
key = sys.argv[2]
dest = sys.argv[3]
s = socket.socket()        
port = 30000       
s.connect(('127.0.0.1', port))
HMAC = customhash(message, key, dest)
msg = {
    "message":message,
    "HMAC Digest":HMAC
}
msg = pickle.dumps(msg)
s.sendall(msg)
s.close()   